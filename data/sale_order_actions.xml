<?xml version="1.0" encoding="UTF-8"?>
<odoo noupdate="1">

    <!-- Action Serveur pour envoyer SaleOrder à l'autre Odoo -->
    <record id="action_send_sale_order_external" model="ir.actions.server">
        <field name="name">Envoyer SaleOrder à Odoo externe</field>
        <field name="model_id" ref="sale.model_sale_order"/>
        <field name="binding_model_id" ref="sale.model_sale_order"/>
        <field name="state">code</field>
        <field name="code">
record.send_to_external_odoo()
        </field>
    </record>

    <!-- Action Automatique après confirmation -->
    <record id="automated_action_send_sale_order" model="base.automation">
        <field name="name">Envoyer SaleOrder après confirmation</field>
        <field name="model_id" ref="sale.model_sale_order"/>
        <field name="trigger">on_update</field>
        <field name="filter_pre_domain">[('state','=','sale'),('transfer_state','=','pending')]</field>
        <field name="state">code</field>
        <field name="code">
action = env.ref('transfer_to_odoo17.action_send_sale_order_external').sudo().run()
        </field>
    </record>

</odoo>
